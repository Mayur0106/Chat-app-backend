var DOMAIN_URL_REG =/^([htfps]+)\:\/\/([a-zA-Z0-9\-\_]+\.[a-zA-Z0-9\-\_\.]+)/;
var URL_REG = /^(((ht|f)tp(s?))\:\/\/)[a-zA-Z0-9\-\_]+\.[a-zA-Z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;

// 需要设置站点信息
exports.siteUrls = [];

exports.isUrl = function (value) {
    return URL_REG.test(value);
};

exports.getDomain = function (url) {
    url = url.replace(/@/, '').toLowerCase();
    var matches = url.match(DOMAIN_URL_REG);
    if (matches && matches.length === 3) {
        return matches.pop();
    }
};

exports.isSameDomain = function (url, siteUrls) {
    var host = this.getDomain(url) || url;
    host = host.toLowerCase();
    siteUrls = siteUrls || exports.siteUrls;
    siteUrls = (typeof siteUrls == 'string') 
        ? siteUrls.split(',')
        : siteUrls;
    if (!siteUrls || siteUrls.length == 0) {
        alert("该账户没有设置网址，请先完善个人信息");
        return false;
    }
    var domains = siteUrls.map(function (site) {
        var domain = exports.getDomain(site);
        var spices = domain.split('.');
        if (spices.length > 2) {
            spices.shift();
        }
        return spices.join('.');
    });
    return domains.some(function (domain) {
        // 前端采用弱检查
        if (domain == host || host.indexOf(domain) > -1 ) {
            return true;
        }
        return false;
    });
};