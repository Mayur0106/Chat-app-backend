/**
 * @validator 模块测试
 *
 * @author Liandong Liu (liu@liandong.org)
 */

describe('validator', function() {
    var validator = require('../index');
    // beforEach(function () {});
    it('正确的通过', function () {
        var info = validator.check('winfo', 'xxx');
        expect(info).toEqual(true);
    });

    it('规则验证-patterns', function () {
        var info = validator.check('winfo', '[xxx]');
        expect(info.patterns).toEqual('关键词名称包含非法字符');
    });

    it('长度规则验证-maxLength', function () {
        var tstr = new Array(16).join(',苹果');
        var info = validator.check('planName', tstr);

        expect(info.maxByteLength).toEqual('计划名称最大长度为15个汉字,或30个字符');
        expect(info.patterns).toEqual('计划名称包含非法字符');
        expect(validator.check('planName', '').minByteLength)
            .toEqual('计划名称不能为空');
    });

    it('验证对象数据检查-checkItem', function () {
        var data = {
            planName: '{计划名称}-北京',
            unitName: '',
            winfo: '[keyword]',
            bid: -5
        };

        var info = validator.checkItem(data);
        expect(info.winfo.patterns).toEqual('关键词名称包含非法字符');
        expect(info.unitName.minByteLength).toEqual('单元名称不能为空');

        expect(validator.checkItem({})).toEqual(true);
        expect(validator.checkItem({title: '创意标题'})).toEqual(true);
    });

    it('验证数据格式', function () {
        expect(validator.isUrl('http://www.sm.cn/')).toEqual(true);
        expect(validator.isUrl('//www.sm.cn/')).toEqual(false);
        expect(validator.isNumber('12.12')).toEqual(true);
        expect(validator.isNumber('12.12%')).toEqual(false);
    });
});